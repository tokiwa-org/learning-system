# 非機能要件

---

## 1. 概要

本書は、人事考課システムにおける非機能要件を定義する。

**対象規模**:

- ユーザー数：約30名
- 同時接続数：最大10名程度
- データ量：年間評価イベント約420件

---

## 2. 性能要件

### 2.1 レスポンスタイム

| 操作種別                | 目標値    | 許容最大値 |
| ----------------------- | --------- | ---------- |
| 画面表示（一覧）        | 1秒以内   | 3秒        |
| 画面表示（詳細）        | 0.5秒以内 | 2秒        |
| データ登録・更新        | 1秒以内   | 3秒        |
| 検索（フィルタ）        | 1秒以内   | 3秒        |
| レポート生成            | 5秒以内   | 30秒       |
| カリキュラム生成（LLM） | 30秒以内  | 60秒       |

### 2.2 スループット

| 指標                   | 要件            |
| ---------------------- | --------------- |
| 同時接続ユーザー数     | 10名            |
| ピーク時リクエスト数   | 100 req/min     |
| バッチ処理（レポート） | 30名分を5分以内 |

### 2.3 データ容量

| データ種別   | 想定容量 | 5年後予測 |
| ------------ | -------- | --------- |
| 社員データ   | 1MB      | 3MB       |
| 評価データ   | 10MB     | 50MB      |
| カリキュラム | 50MB     | 500MB     |
| ログデータ   | 100MB/年 | 500MB     |

---

## 3. 可用性要件

### 3.1 稼働率

| 指標                 | 目標                       |
| -------------------- | -------------------------- |
| 月間稼働率           | 99.5%以上                  |
| 計画停止             | 月1回、最大2時間（深夜帯） |
| 年間許容ダウンタイム | 約43時間                   |

### 3.2 障害対応

| 障害レベル | 定義           | 復旧目標時間（RTO） |
| ---------- | -------------- | ------------------- |
| Critical   | サービス全停止 | 4時間以内           |
| High       | 主要機能停止   | 8時間以内           |
| Medium     | 一部機能停止   | 24時間以内          |
| Low        | 軽微な不具合   | 次回リリース        |

### 3.3 バックアップ・リカバリ

| 項目                 | 要件             |
| -------------------- | ---------------- |
| バックアップ頻度     | 日次（毎日深夜） |
| バックアップ保持期間 | 30日間           |
| RPO（目標復旧時点）  | 24時間以内       |
| RTO（目標復旧時間）  | 4時間以内        |
| リストアテスト       | 四半期ごとに実施 |

**バックアップ対象**:

- Cloudflare D1データベース
- Neo4j Auraデータベース
- 生成済みカリキュラムファイル

---

## 4. セキュリティ要件

### 4.1 認証・認可

| 項目                   | 要件                                      |
| ---------------------- | ----------------------------------------- |
| 認証方式               | Cloudflare Access（SSO）またはID/Password |
| パスワードポリシー     | 8文字以上、英数字混合                     |
| セッションタイムアウト | 30分（無操作時）                          |
| ログイン試行制限       | 5回失敗でアカウントロック（30分）         |
| 多要素認証             | 管理者ロールは必須（フェーズ2）           |

### 4.2 通信セキュリティ

| 項目       | 要件                    |
| ---------- | ----------------------- |
| 通信暗号化 | TLS 1.3以上             |
| 証明書     | Cloudflare管理SSL証明書 |
| API認証    | Bearer Token（JWT）     |

### 4.3 データセキュリティ

| 項目             | 要件                           |
| ---------------- | ------------------------------ |
| 保存時暗号化     | AES-256（D1/Neo4j標準）        |
| 個人情報         | 社員名、メールアドレスのみ     |
| データマスキング | テスト環境では個人情報をマスク |
| データ保持期間   | 退職後3年で削除                |

### 4.4 監査

| 項目         | 要件                           |
| ------------ | ------------------------------ |
| 監査ログ     | 全ての更新操作を記録           |
| ログ保持期間 | 1年間                          |
| アクセスログ | 誰が・いつ・何を閲覧したか記録 |

### 4.5 脆弱性対策

| 対策                | 内容                     |
| ------------------- | ------------------------ |
| SQLインジェクション | パラメータ化クエリの使用 |
| XSS                 | 出力エスケープ、CSP設定  |
| CSRF                | CSRFトークンの検証       |
| 依存パッケージ      | 月次で脆弱性スキャン     |

---

## 5. 運用・保守要件

### 5.1 監視

| 項目         | 内容                       |
| ------------ | -------------------------- |
| 死活監視     | 5分間隔でヘルスチェック    |
| 性能監視     | レスポンスタイム、エラー率 |
| リソース監視 | D1容量、Workers実行時間    |
| アラート通知 | Google Chat通知            |

**監視ダッシュボード**: Cloudflare Analytics + カスタムダッシュボード

### 5.2 ログ管理

| ログ種別     | 保持期間 | 保存先     |
| ------------ | -------- | ---------- |
| アクセスログ | 30日     | Cloudflare |
| エラーログ   | 90日     | Cloudflare |
| 監査ログ     | 1年      | D1         |
| デバッグログ | 7日      | Cloudflare |

### 5.3 デプロイメント

| 項目           | 要件                             |
| -------------- | -------------------------------- |
| デプロイ方式   | Cloudflare Wrangler（CI/CD）     |
| ロールバック   | 1コマンドで前バージョンに戻せる  |
| ブルーグリーン | Cloudflare Pagesのプレビュー機能 |
| デプロイ頻度   | 週1回程度（スプリント終了時）    |

### 5.4 メンテナンス

| 項目                     | 頻度                             |
| ------------------------ | -------------------------------- |
| セキュリティパッチ       | 随時（Critical）、月次（その他） |
| 機能アップデート         | 隔週                             |
| データベースメンテナンス | 四半期                           |
| 依存パッケージ更新       | 月次                             |

---

## 6. 互換性要件

### 6.1 ブラウザサポート

| ブラウザ | バージョン      | サポートレベル |
| -------- | --------------- | -------------- |
| Chrome   | 最新2バージョン | フルサポート   |
| Edge     | 最新2バージョン | フルサポート   |
| Firefox  | 最新2バージョン | フルサポート   |
| Safari   | 最新2バージョン | フルサポート   |
| IE       | 全バージョン    | 非サポート     |

### 6.2 デバイス対応

| デバイス           | 対応                  |
| ------------------ | --------------------- |
| PC（デスクトップ） | フルサポート          |
| タブレット         | レスポンシブ対応      |
| スマートフォン     | 参照のみ（フェーズ1） |

### 6.3 画面解像度

| 解像度        | 対応           |
| ------------- | -------------- |
| 1920×1080以上 | 最適化         |
| 1366×768以上  | サポート       |
| 1024×768以上  | 最低限サポート |

---

## 7. 拡張性要件

### 7.1 スケーラビリティ

| 項目       | 現状  | 拡張目標 |
| ---------- | ----- | -------- |
| ユーザー数 | 30名  | 100名    |
| 同時接続   | 10名  | 30名     |
| データ量   | 100MB | 1GB      |

**スケールアウト戦略**:

- Cloudflare Workers: 自動スケール（追加設定不要）
- Cloudflare D1: シャーディング検討（100名超時）
- Neo4j Aura: Free → Professional Tierへの移行

### 7.2 機能拡張性

| 拡張ポイント     | 対応方針                               |
| ---------------- | -------------------------------------- |
| 新スキル追加     | マスタデータで柔軟に追加               |
| 新情報ソース     | InformationSourceノードで追加          |
| 評価ロジック変更 | 設定ファイルで重み付け変更可能         |
| 外部システム連携 | REST API提供、Webhook対応（フェーズ2） |

---

## 8. 移行要件

### 8.1 データ移行

| 移行元               | 移行データ     | 方式               |
| -------------------- | -------------- | ------------------ |
| 既存スプレッドシート | 社員マスタ     | CSV変換→インポート |
| 既存スプレッドシート | 過去評価データ | CSV変換→インポート |
| 手動                 | スキルマスタ   | 新規登録           |

### 8.2 移行スケジュール

```
1. 移行計画策定（2週間）
2. 移行ツール開発（1週間）
3. テスト移行（1週間）
4. 本番移行（1日）
5. 検証（1週間）
```

---

## 9. 法規制・コンプライアンス

### 9.1 個人情報保護

| 要件             | 対応                       |
| ---------------- | -------------------------- |
| 個人情報保護法   | 利用目的の明示、同意取得   |
| 社内規程         | 人事情報管理規程に準拠     |
| データ主体の権利 | 開示請求、削除請求への対応 |

### 9.2 内部統制

| 要件         | 対応                 |
| ------------ | -------------------- |
| 職務分掌     | 登録者と承認者の分離 |
| アクセス制御 | 最小権限の原則       |
| 証跡         | 監査ログの保全       |

---

## 10. コスト要件

### 10.1 インフラコスト（月額）

| サービス              | プラン | 月額概算 |
| --------------------- | ------ | -------- |
| Cloudflare Workers    | Free   | $0       |
| Cloudflare D1         | Free   | $0       |
| Cloudflare Pages      | Free   | $0       |
| Neo4j Aura            | Free   | $0       |
| **合計（フェーズ1）** |        | **$0**   |

### 10.2 拡張時コスト

| 条件                | 追加コスト                   |
| ------------------- | ---------------------------- |
| ユーザー100名超     | Neo4j Professional: $65/月〜 |
| D1容量超過          | $0.75/GB/月                  |
| Workers実行時間超過 | $0.15/百万リクエスト         |

---

## 11. 非機能要件トレーサビリティ

| 要件ID | 要件名           | 対応技術/方式       |
| ------ | ---------------- | ------------------- |
| NFR-01 | レスポンス1秒    | Cloudflare Edge, D1 |
| NFR-02 | 稼働率99.5%      | Cloudflare SLA      |
| NFR-03 | 日次バックアップ | D1自動バックアップ  |
| NFR-04 | TLS通信          | Cloudflare SSL      |
| NFR-05 | 監査ログ         | D1監査テーブル      |

---

_作成日: 2026年1月24日_ _トキワテック 人事考課システム_

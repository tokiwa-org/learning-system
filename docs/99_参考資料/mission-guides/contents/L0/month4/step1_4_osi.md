# ネットワークの階層モデル

## メタ情報

```yaml
mission: "ネットワークの仕組みを解明しよう"
step: 1
subStep: 4
title: "ネットワークの階層モデル"
itemType: LESSON
estimatedMinutes: 25
noiseLevel: MINIMAL
roadmap:
  skill: "ネットワーク"
  category: "IT基本"
  target_level: "L0"
```

---

## ストーリー

> 「先輩、プロトコルがたくさんあるのは分かったんですが、どう整理されているんですか？」
>
> 「いい質問だね。ネットワークの通信は"層"で整理されているんだ」
>
> 「層？」
>
> 「ケーキを重ねるように、下から順番に役割が決まっている。これを理解すると全体像が見えるよ」

---

## なぜ階層に分けるのか

### 問題：すべてを一度に処理すると複雑になる

Webページを表示するために必要なこと：

1. 電気信号をケーブルで送る
2. 隣のルーターにデータを渡す
3. 正しい宛先にデータを届ける
4. データが確実に届いたか確認する
5. Webページのデータを解釈する

これを全部1つのプロトコルで処理するのは大変です。

### 解決策：役割ごとに層に分ける

```
「手紙を書く」     → アプリケーション層
「書留にする」     → トランスポート層
「宛先を書く」     → インターネット層
「ポストに入れる」 → ネットワークアクセス層
```

各層が自分の仕事だけに集中し、下の層に処理を任せます。

---

## OSI参照モデル（7層）

教科書でよく見る正式なモデルは7層です。参考として知っておきましょう。

| 層 | 名前 | 役割 |
|----|------|------|
| 7 | アプリケーション層 | ユーザーに近い処理（HTTP, DNS） |
| 6 | プレゼンテーション層 | データの形式変換（暗号化、圧縮） |
| 5 | セッション層 | 通信の開始・終了の管理 |
| 4 | トランスポート層 | データの信頼性（TCP, UDP） |
| 3 | ネットワーク層 | 宛先の指定と経路選択（IP） |
| 2 | データリンク層 | 隣接機器との通信（Ethernet） |
| 1 | 物理層 | 電気信号・光信号の送受信 |

---

## TCP/IPモデル（4層） -- 実務ではこちらが重要

実際のインターネットでは、OSIの7層を簡略化した **TCP/IPモデル（4層）** が使われています。

```
┌─────────────────────────┐
│  アプリケーション層       │  HTTP, DNS, SSH, SMTP
├─────────────────────────┤
│  トランスポート層         │  TCP, UDP
├─────────────────────────┤
│  インターネット層         │  IP, ICMP
├─────────────────────────┤
│  ネットワークアクセス層   │  Ethernet, Wi-Fi
└─────────────────────────┘
```

### 各層の役割

#### 第4層：アプリケーション層

**ユーザーが直接使うプロトコル** が動く層。

- HTTP/HTTPS：Webページの通信
- DNS：ドメイン名の解決
- SSH：リモートログイン
- SMTP：メール送信

> 例え：手紙の「内容」に相当

#### 第3層：トランスポート層

**データの配送品質** を管理する層。

- TCP：確実に届ける（書留郵便）
- UDP：素早く届ける（普通郵便）

> 例え：「書留にするか普通郵便にするか」の選択

#### 第2層：インターネット層

**宛先の指定と経路選択** を行う層。

- IP：宛先のIPアドレスを指定
- ICMP：ネットワーク診断（pingで使用）

> 例え：封筒に「宛先住所」を書くこと

#### 第1層：ネットワークアクセス層

**物理的な通信** を担当する層。

- Ethernet：LANケーブルでの通信
- Wi-Fi：無線通信
- 光ファイバー

> 例え：手紙を「ポストに入れて運ぶ」こと

---

## データの流れ（カプセル化）

データが送信されるとき、各層で「ヘッダー」が追加されていきます。これを **カプセル化** と言います。

### 送信側（上から下へ）

```
アプリケーション層:  [HTTPデータ]
                         ↓ TCPヘッダーを追加
トランスポート層:    [TCP][HTTPデータ]
                         ↓ IPヘッダーを追加
インターネット層:    [IP][TCP][HTTPデータ]
                         ↓ Ethernetヘッダーを追加
ネットワーク層:  [Eth][IP][TCP][HTTPデータ]
```

### 受信側（下から上へ）

```
ネットワーク層:  [Eth][IP][TCP][HTTPデータ]
                         ↓ Ethernetヘッダーを除去
インターネット層:    [IP][TCP][HTTPデータ]
                         ↓ IPヘッダーを除去
トランスポート層:    [TCP][HTTPデータ]
                         ↓ TCPヘッダーを除去
アプリケーション層:  [HTTPデータ]
```

手紙の例えなら、封筒を入れ子にしていくイメージです。

---

## Webページ表示の全体像

ブラウザで `http://www.example.com` にアクセスしたとき：

```
1. [アプリケーション層] ブラウザがHTTPリクエストを作成
2. [トランスポート層]   TCPで確実に届ける準備
3. [インターネット層]   IPアドレスで宛先を指定
4. [ネットワーク層]     Wi-Fi/LANケーブルで送信
        ↓ （インターネットを経由）
5. [ネットワーク層]     サーバーが電気信号を受信
6. [インターネット層]   IPアドレスを確認
7. [トランスポート層]   TCPでデータを再構成
8. [アプリケーション層] WebサーバーがHTTPレスポンスを返す
```

---

## まとめ

| ポイント | 内容 |
|----------|------|
| OSI参照モデル | 7層の理論的なモデル（教科書向け） |
| TCP/IPモデル | 4層の実用的なモデル（実務向け） |
| カプセル化 | 各層でヘッダーを追加してデータを包む |
| 階層化のメリット | 役割を分離し、各層が独立して改良できる |

### チェックリスト
- [ ] TCP/IPモデルの4つの層を順番に言える
- [ ] 各層の役割を簡単に説明できる
- [ ] カプセル化の仕組みを理解した
- [ ] Webページ表示の通信の流れをイメージできる

---

## 次のステップへ

ネットワークの階層モデルが理解できましたね。

次のセクションでは、ここまでに出てきた用語を整理して、ネットワークの **基本用語** をまとめて覚えます。

---

*推定読了時間: 25分*

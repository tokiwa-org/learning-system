# ADR: インタラクティブ可視化の技術選定

## ステータス

**提案中** - 2026-01-26

---

## コンテキスト

ミッション型学習システムでは、抽象的な概念（アルゴリズム、データ構造、Git操作、ネットワーク通信など）を視覚的に理解させるため、インタラクティブな可視化機能が有効である。

### 要件

| 要件 | 優先度 | 説明 |
|-----|--------|------|
| ブラウザ完結 | 必須 | プラグイン不要、URLアクセスのみで利用可能 |
| インタラクティブ性 | 必須 | ユーザー操作に応じたリアルタイム描画 |
| 学習効果 | 高 | 抽象概念の直感的理解を促進 |
| パフォーマンス | 高 | 60fps以上のスムーズなアニメーション |
| 自前ホスト可能 | 高 | OSSライセンスで自由にカスタマイズ・デプロイ可能 |
| 既存技術との統合 | 中 | React/Astro環境への組み込みやすさ |

### 対象となる学習コンテンツ

| レベル | ミッション | 可視化対象 |
|-------|-----------|-----------|
| L0 月2 | Git入門 | コミットグラフ、add/commit/pushの流れ |
| L0 月3 | SQL入門 | クエリ実行プラン、テーブル結合 |
| L0 月4 | ネットワーク | パケットの流れ、DNS解決、HTTP通信 |
| L1 | アルゴリズム | ソート、探索、データ構造 |
| L2 | Web開発 | DOM構造、イベント伝播 |

---

## 検討した選択肢

### 2D描画ライブラリ

#### 1. D3.js

| 項目 | 評価 |
|-----|------|
| 概要 | データ駆動型のSVG/Canvas描画ライブラリ |
| 得意分野 | グラフ、チャート、ネットワーク図 |
| パフォーマンス | △ SVGは大量要素で遅い、Canvasは高速 |
| 学習コスト | 高（独自のデータバインディング概念） |
| ライセンス | ISC（OSS） |

**評価**: ◯ データ可視化向け
- グラフ構造（Git、ネットワーク）に最適
- アルゴリズム可視化の実績多数

#### 2. PixiJS

| 項目 | 評価 |
|-----|------|
| 概要 | 高速2D WebGLレンダリングエンジン |
| 得意分野 | ゲーム、アニメーション、大量オブジェクト |
| パフォーマンス | ◎ WebGL活用で非常に高速 |
| 学習コスト | 中 |
| ライセンス | MIT（OSS） |

**評価**: ◯ アニメーション重視の場合に有効
- ソートアルゴリズムの大量要素アニメーションに最適

### 3D描画ライブラリ

#### 3. Three.js

| 項目 | 評価 |
|-----|------|
| 概要 | 最も普及したWebGL 3Dライブラリ |
| 得意分野 | 3D可視化、インタラクティブ空間 |
| パフォーマンス | ◎ WebGL活用 |
| 学習コスト | 中〜高 |
| ライセンス | MIT（OSS） |
| React統合 | react-three-fiber で容易 |

**評価**: ◯ 3D表現が必要な場合に採用
- Gitリポジトリの3D可視化（City Blocks風）
- ネットワークトポロジーの3D表示

#### 4. Babylon.js

| 項目 | 評価 |
|-----|------|
| 概要 | Microsoft製の3Dエンジン |
| 得意分野 | ゲーム、VR/AR |
| パフォーマンス | ◎ |
| 学習コスト | 中 |
| ライセンス | Apache 2.0（OSS） |

**評価**: △ 今回の用途ではオーバースペック

### 特化型ツール

#### 5. Mermaid

| 項目 | 評価 |
|-----|------|
| 概要 | テキストベースのダイアグラム生成 |
| 得意分野 | フローチャート、シーケンス図、Git履歴 |
| インタラクティブ性 | △ 静的描画が主 |
| 学習コスト | 低 |
| ライセンス | MIT（OSS） |

**評価**: ◯ 静的な図解に使用
- 学習コンテンツ内の図解に適切

---

## 既存事例の調査

### Git可視化

| ツール | 技術 | 特徴 |
|--------|------|------|
| [Visualizing Git](https://git-school.github.io/visualizing-git/) | D3.js | Git操作の学習に最適、操作結果をリアルタイム反映 |
| [gitVis3D](https://github.com/kofujimura/gitVis3D) | Three.js | リポジトリを3D空間で表示 |
| [City Blocks](https://github.com/cjayawickrema/city-blocks) | Three.js | コード量を建物の体積で表現 |
| [Gource](https://gource.io/) | OpenGL | リポジトリ履歴のアニメーション |

### アルゴリズム可視化

| ツール | 技術 | 特徴 |
|--------|------|------|
| [VisuAlgo](https://visualgo.net/) | Canvas/SVG | 21+種のアルゴリズム、教育機関発 |
| [Algorithm Visualizer](https://algorithm-visualizer.org/) | D3.js | コードから可視化を生成 |
| [Sort Visualizer](https://sortvisualizer.com/) | Canvas | 15種以上のソートを比較 |

---

## 決定

**用途別に技術を使い分ける** 方針を採用する。

| 用途 | 採用技術 | 理由 |
|------|----------|------|
| Git操作の可視化 | **D3.js** | Visualizing Gitの実績、グラフ構造に最適 |
| アルゴリズム可視化 | **PixiJS** または **Canvas API** | 大量要素のアニメーションに高速 |
| ネットワーク可視化 | **D3.js** + **Three.js** | トポロジーは2D、パケットフローは3Dも検討 |
| 静的な図解 | **Mermaid** | Markdown内で簡潔に記述可能 |

---

## 理由

### 1. 学習効果の最大化

```
抽象的な概念 → 視覚化 → 直感的理解
```

研究によると、視覚的な学習教材は理解度を30-50%向上させる効果がある。

### 2. 既存事例の活用

| 対象 | 参考実装 | 活用方法 |
|------|----------|----------|
| Git | Visualizing Git | 同様のインタラクションを実装 |
| アルゴリズム | VisuAlgo | UIパターンを参考に |

### 3. 技術スタックとの親和性

```
既存スタック:
├── Astro + React
├── v86 (学習実行環境)
└── 追加する可視化レイヤー
    ├── D3.js (データ可視化)
    ├── PixiJS (2Dアニメーション)
    └── react-three-fiber (3D、必要時)
```

---

## アーキテクチャ

### コンポーネント構成

```
┌─────────────────────────────────────────────────────────┐
│  学習画面                                               │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐  ┌──────────────────────────┐ │
│  │                     │  │                          │ │
│  │  学習コンテンツ      │  │  可視化パネル             │ │
│  │  (Markdown)         │  │                          │ │
│  │                     │  │  ┌──────────────────┐   │ │
│  │  Step 1-5:          │  │  │ GitGraph         │   │ │
│  │  Gitの基本用語      │  │  │ (D3.js)          │   │ │
│  │                     │  │  │                  │   │ │
│  │  > git add file.txt │  │  │  ○ ← commit     │   │ │
│  │  > git commit -m... │  │  │  │               │   │ │
│  │                     │  │  │  ○              │   │ │
│  │                     │  │  └──────────────────┘   │ │
│  └─────────────────────┘  └──────────────────────────┘ │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  v86 Terminal                                    │   │
│  │  $ git add file.txt                              │   │
│  │  $ git commit -m "Add file"                      │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

### 可視化コンポーネント例

```tsx
// GitGraphVisualizer.tsx
import { useEffect, useRef } from 'react';
import * as d3 from 'd3';

interface Commit {
  id: string;
  message: string;
  parent?: string;
}

export function GitGraphVisualizer({ commits }: { commits: Commit[] }) {
  const svgRef = useRef<SVGSVGElement>(null);

  useEffect(() => {
    // D3.jsでコミットグラフを描画
    const svg = d3.select(svgRef.current);
    // ... 描画ロジック
  }, [commits]);

  return <svg ref={svgRef} width={400} height={300} />;
}
```

---

## 適用予定のミッション

### 優先度: 高

| ミッション | 可視化内容 | 技術 |
|-----------|-----------|------|
| L0 月2: Git入門 | コミットグラフ、ステージング状態 | D3.js |
| L0 月4: ネットワーク | パケットの流れ、DNS解決シーケンス | D3.js |

### 優先度: 中

| ミッション | 可視化内容 | 技術 |
|-----------|-----------|------|
| L0 月3: SQL | テーブル結合の図解 | Mermaid / D3.js |
| L1: アルゴリズム | ソート、探索の可視化 | PixiJS |

### 優先度: 低（将来検討）

| ミッション | 可視化内容 | 技術 |
|-----------|-----------|------|
| L2: Web開発 | DOM構造、イベント伝播 | D3.js |
| L3: 設計 | アーキテクチャ図 | Mermaid / Three.js |

---

## 影響

### ポジティブ

| 影響 | 詳細 |
|-----|------|
| 学習効果向上 | 抽象概念の直感的理解を促進 |
| 差別化 | 他の学習サービスとの差別化要因 |
| エンゲージメント | インタラクティブ性による学習継続率向上 |

### ネガティブ（対策含む）

| 影響 | 対策 |
|-----|------|
| 開発工数増加 | 優先度を付けて段階的に実装 |
| パフォーマンス | 遅延読み込み、必要時のみ初期化 |
| 保守コスト | 可視化コンポーネントを共通化・再利用 |

---

## 今後の検討事項

| 項目 | 内容 | 優先度 |
|-----|------|--------|
| GitGraph POC | D3.jsでのコミットグラフ可視化プロトタイプ | 高 |
| v86連携 | ターミナル操作と可視化の同期 | 高 |
| コンポーネント設計 | 再利用可能な可視化コンポーネント設計 | 中 |
| アルゴリズム可視化 | ソートアルゴリズムのPOC | 中 |

---

## 参考資料

### Git可視化

- [Visualizing Git](https://git-school.github.io/visualizing-git/)
- [gitVis3D - GitHub](https://github.com/kofujimura/gitVis3D)
- [City Blocks](https://github.com/cjayawickrema/city-blocks)
- [Gource](https://gource.io/)

### アルゴリズム可視化

- [VisuAlgo](https://visualgo.net/en)
- [Algorithm Visualizer](https://algorithm-visualizer.org/)
- [Sort Visualizer](https://sortvisualizer.com/)
- [USF Data Structure Visualization](https://www.cs.usfca.edu/~galles/visualization/Algorithms.html)

### ライブラリ

- [D3.js](https://d3js.org/)
- [PixiJS](https://pixijs.com/)
- [Three.js](https://threejs.org/)
- [react-three-fiber](https://docs.pmnd.rs/react-three-fiber/)
- [Mermaid](https://mermaid.js.org/)

---

*作成日: 2026-01-26*

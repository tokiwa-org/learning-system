# ADR: 学習実行環境の技術選定

## ステータス

**承認済み** - 2026-01-26

---

## コンテキスト

ミッション型学習システムでは、ブラウザ上でLinuxコマンドを実行できる環境が必要である。

### 要件

| 要件 | 優先度 | 説明 |
|-----|--------|------|
| Linuxコマンド実行 | 必須 | pwd, ls, cd, mkdir, rm 等の基本コマンド |
| ブラウザ完結 | 必須 | インストール不要、URLアクセスのみで利用可能 |
| 本物のLinux体験 | 高 | 実務と同じコマンド・挙動であること |
| 起動速度 | 中 | 学習の妨げにならない程度（30秒以内） |
| カスタマイズ | 中 | プリセット環境の用意、ファイル配置等 |
| 永続化 | 低 | 学習用途のため毎回リセットでも可 |

### 対象レベル

- **L0（未経験者）**: ターミナル基礎、ファイル操作
- **L1（新人）**: Git操作、開発環境構築
- **L2以上**: Docker、クラウド等は別途検討

---

## 検討した選択肢

### 1. StackBlitz (WebContainers)

| 項目 | 評価 |
|-----|------|
| 概要 | ブラウザ内でNode.js環境を実行 |
| 得意分野 | モダンWeb開発（React, Vue, Node.js） |
| Linuxコマンド | 一部のみ（Node.js依存） |
| 起動速度 | 爆速（数秒） |
| ネットワーク | 制限あり（仮想化） |

**評価**: ❌ 不採用
- Node.js環境に特化しており、純粋なLinuxコマンド学習には不向き
- `apt`, `yum` 等のパッケージ管理が使えない

### 2. WebVM

| 項目 | 評価 |
|-----|------|
| 概要 | ブラウザ内で本物のLinux（Debian）を実行 |
| 得意分野 | Linuxシステム、OS学習 |
| Linuxコマンド | 完全対応（本物のバイナリ） |
| 起動速度 | 普通（10-30秒、キャッシュ後は高速） |
| ネットワーク | Tailscale経由で接続可能 |

**評価**: ✅ 採用
- 本物のLinux環境がブラウザで動作
- 実務と同じコマンドがそのまま使える
- 教育的価値が高い（「本物を触っている」実感）

### 3. JupyterLite

| 項目 | 評価 |
|-----|------|
| 概要 | ブラウザ内でJupyter Notebookを実行 |
| 得意分野 | Python、科学計算、データ分析 |
| Linuxコマンド | 限定的（`!`プレフィックスでシェルコマンド） |
| 起動速度 | 速い |
| ネットワーク | ほぼなし |

**評価**: ❌ 不採用（ターミナル学習用途では）
- Python学習には最適だが、ターミナル基礎学習には不向き
- 将来的にPython/データ分析カリキュラムで活用可能

---

## 決定

**WebVM** を学習実行環境として採用する。

---

## 理由

### 1. 本物のLinux体験

```
WebVM = 本物のDebian Linux がブラウザで動作
      ≠ シミュレーション
      ≠ 一部コマンドのみ対応
```

L0学習者が最初に触れる環境として、「本物」であることが重要。
実務に移行した際のギャップを最小化できる。

### 2. 教育的価値

| 観点 | WebVMの利点 |
|-----|------------|
| 心理的効果 | 「本物のLinuxを動かしている」という達成感 |
| 転移学習 | 学んだコマンドがそのまま実務で使える |
| トラブル体験 | 本物のエラーメッセージに触れられる |

### 3. 技術的実現性

- **埋め込み対応**: iframeで学習コンテンツに埋め込み可能
- **カスタマイズ**: 独自ビルドでプリセット環境を用意可能
- **オープンソース**: MITライセンス、自由に利用可能

---

## アーキテクチャ

### 学習画面構成

```
┌─────────────────────────────────────────────────────────┐
│  ミッション: 初めてのターミナルを起動しよう              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────┐  ┌──────────────────────────┐ │
│  │                     │  │                          │ │
│  │  学習コンテンツ      │  │  WebVM (Linux Terminal)  │ │
│  │  (Markdown)         │  │                          │ │
│  │                     │  │  $ pwd                   │ │
│  │  - 説明             │  │  /home/user              │ │
│  │  - 手順             │  │  $ ls                    │ │
│  │  - ヒント           │  │  Documents Downloads     │ │
│  │                     │  │  $ _                     │ │
│  │                     │  │                          │ │
│  └─────────────────────┘  └──────────────────────────┘ │
│                                                         │
│  [前へ]  ステップ 1/6  [次へ]                           │
└─────────────────────────────────────────────────────────┘
```

### 技術スタック

```
┌─────────────────────────────────────────┐
│  学習UI (Cloudflare Pages)              │
│  - Astro + React                        │
│  - Markdown コンテンツ                   │
├─────────────────────────────────────────┤
│  WebVM (iframe埋め込み)                  │
│  - webvm.io または 自前ホスト            │
│  - Debian Linux                         │
│  - CheerpX (x86仮想化エンジン)           │
└─────────────────────────────────────────┘
```

### WebVM設定

```javascript
// WebVM埋め込み例
<iframe
  src="https://webvm.io/?folder=/home/user/exercises"
  width="100%"
  height="400"
  allow="cross-origin-isolated"
/>
```

---

## 影響

### ポジティブ

| 影響 | 詳細 |
|-----|------|
| 学習品質向上 | 本物のLinux環境で実践的な学習が可能 |
| 環境構築不要 | 学習者のPC環境に依存しない |
| スケーラビリティ | クライアントサイドで実行、サーバー負荷なし |

### ネガティブ（対策含む）

| 影響 | 対策 |
|-----|------|
| 初回起動が遅い | ローディング中に前回の復習コンテンツを表示 |
| ブラウザ依存 | 推奨ブラウザ（Chrome, Edge）を明記 |
| 永続化なし | 学習用途では毎回リセットで問題なし |

---

## 将来の拡張

| レベル | 実行環境 | 用途 |
|-------|---------|------|
| L0-L1 | WebVM | ターミナル基礎、Git基礎 |
| L1-L2 | StackBlitz | Web開発（HTML/CSS/JS、Node.js） |
| L2-L3 | JupyterLite | Python、データ分析 |
| L3以上 | Gitpod / Codespaces | Docker、クラウド、本格開発 |

---

## 参考資料

- [WebVM公式サイト](https://webvm.io/)
- [WebVM GitHub](https://github.com/nickveltmaat/webvm)
- [CheerpX (仮想化エンジン)](https://cheerpx.io/)
- [StackBlitz WebContainers](https://webcontainers.io/)
- [JupyterLite](https://jupyterlite.readthedocs.io/)

---

*作成日: 2026-01-26*
